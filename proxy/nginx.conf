# Defines the upstream service for the FastAPI backend.
# 'app:8000' points to the 'app' service defined in docker-compose.yml on its exposed port.
upstream docuhub_backend {
    server app:8000;
}

server {
    listen 80;
    server_name localhost; # Or your domain

    # --- Static Documentation Site (MkDocs) ---
    # Handles all requests prefixed with /docs/, e.g., http://localhost:8080/docs/
    location /docs/ {
        # 'root' is generally safer and more flexible than 'alias'.
        # It maps the URL path directly to the filesystem path.
        # /docs/index.html -> /var/www/html/index.html
        root /var/www/html;
        index index.html;
        try_files $uri $uri/ =404;
    }

    # --- FastAPI Application (API, Editor, Login) ---
    # A catch-all for any other request.
    location / {
        proxy_pass http://docuhub_backend;

        # Standard proxy headers to forward client information to the backend app.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Health check header (optional but good practice)
        proxy_set_header X-NginX-Proxy true;

        proxy_redirect off;
    }

    # --- Error Pages (Optional but Professional) ---
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html; # Default Nginx error page location
    }
}