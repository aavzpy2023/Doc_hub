upstream docuhub_backend {
    server app:8000;
}

server {
    listen 80;
    server_name localhost;

    # --- 1. API Reverse Proxy ---
    # All requests prefixed with /api/ will be forwarded to the FastAPI backend.
    # e.g., http://localhost:8080/api/v1/users -> http://app:8000/api/v1/users
    location /api/ {
        proxy_pass http://docuhub_backend;

        # Standard proxy headers to forward client information.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_redirect off;
    }

    # --- 2. Static Documentation Site (MkDocs) ---
    # Handles all requests prefixed with /docs/, e.g., http://localhost:8080/docs/
    location /docs/ {
        # 'root' maps the URL path directly to the filesystem path.
        # /docs/index.html -> /var/www/docs/index.html
        root /var/www/docs;
        index index.html;
        try_files $uri $uri/ =404;
    }
    
    # --- 3. Frontend Static Files (HTML/CSS/JS) ---
    # This is the catch-all location for the main application frontend.
    location / {
        # The root directory where frontend files are located.
        root /var/www/frontend;
        # Default file to serve.
        index login.html index.html;
        # Tries to serve the requested file directly, otherwise falls back to the login page.
        try_files $uri $uri/ /login.html;
    }

    # --- Optional: Custom Error Pages ---
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        # Use Nginx's default error pages.
        root /usr/share/nginx/html;
    }
}